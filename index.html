<script>
const params = new URLSearchParams(window.location.search);
const assetId = (params.get('id') || "").trim().toUpperCase();

/* ================================
   DAFTAR CSV DARI BANYAK SHEET
================================ */
const sheetList = [
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=0&output=csv",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1802188553&output=csv",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=130752718&output=csv",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1268094999&output=csv",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=1350866735&output=csv",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrCSj8LkK4jgexXAggrcwR8T9dg4vgRCq2HWMBVbDaWzo5cZXanwUJpFwGVMhjVjOPygZ4XUHb3CSq/pub?gid=719158736&output=csv"
];

/* ================================
   CSV PARSER (AMAN DARI KOMA)
================================ */
function parseCSV(text) {
  const rows = [];
  let row = [];
  let current = "";
  let insideQuotes = false;

  for (let char of text) {
    if (char === '"') {
      insideQuotes = !insideQuotes;
    } else if (char === "," && !insideQuotes) {
      row.push(current.trim());
      current = "";
    } else if (char === "\n" && !insideQuotes) {
      row.push(current.trim());
      rows.push(row);
      row = [];
      current = "";
    } else {
      current += char;
    }
  }
  if (current) {
    row.push(current.trim());
    rows.push(row);
  }
  return rows;
}

/* ================================
   BADGE KONDISI
================================ */
function badgeKondisi(text) {
  text = (text || "").toLowerCase();
  if (text.includes("baik")) return `<span class="badge bg-success">Baik</span>`;
  if (text.includes("rusak")) return `<span class="badge bg-danger">Rusak</span>`;
  if (text.includes("perbaikan")) return `<span class="badge bg-warning text-dark">Perbaikan</span>`;
  return `<span class="badge bg-secondary">${text || "-"}</span>`;
}

/* ================================
   LOAD ASSET DARI SEMUA SHEET
================================ */
async function loadAsset() {
  if (!assetId) {
    document.getElementById("data").innerHTML =
      `<div class="alert alert-danger">Asset ID tidak ditemukan</div>`;
    return;
  }

  for (const url of sheetList) {
    try {
      const res = await fetch(url);
      const csvText = await res.text();
      const rows = parseCSV(csvText);

      for (let i = 1; i < rows.length; i++) {
        const col = rows[i];
        const sheetId = (col[0] || "").trim().toUpperCase();

        if (sheetId === assetId) {
          document.getElementById("data").innerHTML = `
            <table class="table table-bordered">
              <tr><th>ID Aset</th><td>${col[0]}</td></tr>
              <tr><th>Nama</th><td>${col[1] || "-"}</td></tr>
              <tr><th>Kategori</th><td>${col[2] || "-"}</td></tr>
              <tr><th>Lokasi</th><td>${col[3] || "-"}</td></tr>
              <tr><th>Kondisi</th><td>${badgeKondisi(col[4])}</td></tr>
              <tr><th>PIC</th><td>${col[5] || "-"}</td></tr>
            </table>
          `;
          return; // STOP setelah ketemu
        }
      }
    } catch (e) {
      console.error("Gagal baca:", url);
    }
  }

  document.getElementById("data").innerHTML =
    `<div class="alert alert-warning">Aset tidak ditemukan di semua sheet</div>`;
}

loadAsset();
</script>
